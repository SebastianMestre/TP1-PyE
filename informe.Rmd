---
title: "TP1"
output:
  pdf_document:
    toc: yes
    toc_depth: 3
    number_sections: yes
  html_document:
    toc: yes
    toc_depth: '3'
    df_print: paged
---
# Introducción
EcoBici es un sistema de bicicletas compartidas que funciona en la Ciudad de Buenos Aires, cuenta
con más de 200 estaciones y 1.200 rodados. Actualmente el sistema está presente en 30 de los 48
barrios de la Ciudad Autónoma de Buenos Aires, funcionando los 365 días del a˜no 24 horas. Existen
2 formas de usar el sistema: mediante una app o mediante una tarjeta. Mediante la app, el usuario
debe registrarse y, mediante su nombre de usuario y password, ingresa al sistema, elige la estación
en la que se encuentra y luego elige la bici que quiere. Mediante tarjeta, el usuario debe apoyarla
en un lector y el sistema le asigna una bicicleta. El usuario se moviliza por la ciudad durante
un tiempo limitado (30 minutos) y luego debe devolver la bicicleta en alguna de las estaciones
habilitadas. El sistema le asigna al usuario un id y registra datos tales como la edad, el género,
estación de origen, estación de destino... etc.  

# Objetivos

El objetivo de este informe es reflejar las características más notables acerca de los datos brindados.  
Para llevar esto a cabo se va a utilizar un software estadístico que permita efectuar un estudio
descriptivo que incluya: tablas de distribución de frecuencias, gráficos y medidas descriptivas.  

# Análisis

## Análisis univariado
### Edad

```{r message=FALSE, echo = FALSE, warning = FALSE}
library(qcc)

usuarios <- read.table("usuarios8.csv", header = TRUE, sep = ",")

hist(usuarios$edad, main="Distrubucion de edad de los usuarios", col="#D5B7E8", xlab="Edad", ylab="Frecuencia", xlim=range(10:70))
```
Se puede observar en este histograma que la mayoría de los usuarios estan en las franjas etarias más bajas. Más especificamente, a partir de los 40 años la cantidad de usuarios baja considerablemente. Una aclaración importante es que el número de personas que figuran entre 15 y 20 años es baja, ya que sólo estamos teniendo en cuenta los mayores a 18. 
```{r message=FALSE, echo = FALSE, warning = FALSE}
cortusuarios <- table(cut(usuarios$edad, breaks=10, right=FALSE, dig.lab = 0))
cumusuarios <- cumsum(cortusuarios)
tablausuarios <- cbind(cortusuarios,cumusuarios,cortusuarios/length(usuarios$edad),cumusuarios/length(usuarios$edad))
colnames(tablausuarios) <- (c("Frecuencia absoluta","Frecuencia absoluta acumulada","Frecuencia relativa","Frecuencia relativa acumulada"))
knitr::kable(tablausuarios)

```
En esta tabla podemos ver incluso mejor como llegado a los 33 años, la frecuencia acumulada es casi del 60%.

```{r message=FALSE, echo = FALSE, warning = FALSE}

recorridos <- read.table("recorridos8.csv", header = TRUE, sep = ",")
usuariosrecorridos <- merge(usuarios, recorridos)

hist(usuariosrecorridos$edad, xlab = "Edad", ylab = "Frecuencia", main = "Recorridos por Edad")

recorridos <- read.table("recorridos8.csv", header = TRUE, sep = ",")
usuariosrecorridos <- merge(usuarios, recorridos)

recxusu <- table(usuariosrecorridos$edad)/table(usuarios$edad)

barplot(recxusu, main="Viajes realizados por usuario, repartidos por edad", xlab="Edad", ylab="Viajes por usuario", ylim=range(0:14), col="#8E67A7")


```

El gráfico de ditribución de recorridos por edad nos muestra resultados similares a lo visto en el análisis de usuarios por edad.
Sin embargo, una cosa interesante sucede cuando se analiza los viajes realizados por usuario, repartiendolos en cada edad. Se puede ver que si bien hay una leve tendencia a que baje este número, no es nada determinante.
O sea, lo que podemos decir es que el hecho de que haya menos viajes realizados por gente mayor a 40 años, no tiene que ver tan directamente con que cada usuario haga menos viajes. Sino que se puede asociar también con el hecho de que son menos los usuarios en esas edades. Esto es lo que termina causando el tamaño de la disparidad.  
\newpage  

### Género
Se analizará ahora la distrución del género. Algo interesante para acotar es que si un usuario no proporciona esta información, por defecto su género asignado será "Otro". Esto significa que los datos no representan exactamente la distribución de género real.

```{r message=FALSE, echo = FALSE, warning = FALSE}

usuarios <- read.table("usuarios8.csv", header = TRUE, sep = ",")
recorridos <- read.table("recorridos8.csv", header = TRUE, sep = ",")
usuariosrecorridos <- merge(usuarios, recorridos)


filtrarPorGenero <- function(usuarios, genero) {
  mascara <- apply(usuarios, MARGIN=c(1), FUN = function(x){ return(x[2] == genero) })
  filtrado <- usuarios[mascara, 1:3]
  return(filtrado)
}

hombres <- filtrarPorGenero(usuarios, "M")
mujeres <- filtrarPorGenero(usuarios, "F")
nonbiny <- filtrarPorGenero(usuarios, "OTRO")

viajes_hombres = filtrarPorGenero(usuariosrecorridos, "M")
viajes_mujeres = filtrarPorGenero(usuariosrecorridos, "F")
viajes_nonbiny = filtrarPorGenero(usuariosrecorridos, "OTRO")

pieUsuariosXGenero <- function() {
  cant_usuarios_genero = c(dim(hombres)[1], dim(mujeres)[1], dim(nonbiny)[1])
  labels_usuarios_genero = c(paste("Hombres ", dim(hombres)[1]/dim(usuarios)[1]*100, "%", sep = ""),
                             paste("Mujeres ", dim(mujeres)[1]/dim(usuarios)[1]*100, "%", sep = ""),
                             paste("Otro ", dim(nonbiny)[1]/dim(usuarios)[1]*100, "%", sep = ""))
  pie(cant_usuarios_genero,
      labels = labels_usuarios_genero,
      col=c("#82B5F1","#E84B89","#E5EC6D"),
      main = "Usuarios por Genero")
}

pieViajesXGenero <- function() {
  cant_viajes_genero = c(dim(viajes_hombres)[1], dim(viajes_mujeres)[1], dim(viajes_nonbiny)[1])
  labels_viajes_genero = c(paste("Hombres ", round(dim(viajes_hombres)[1]/dim(usuariosrecorridos)[1]*100), "%", sep = ""),
                           paste("Mujeres ", round(dim(viajes_mujeres)[1]/dim(usuariosrecorridos)[1]*100), "%", sep = ""),
                           paste("Otros ", round(dim(viajes_nonbiny)[1]/dim(usuariosrecorridos)[1]*100), "%", sep = ""))
  pie(cant_viajes_genero,
      labels = labels_viajes_genero,
      col=c("#82B5F1","#E84B89","#E5EC6D"),
      main = "Viajes por Genero") 
}
pieUsuariosXGenero()
```

Por ambos gráficos se puede observar que:  
- la mayoría de usuarios son mujeres  
- la mayoría de viajes lo realizan mujeres  
Estos datos tienen una relación directa y se puede decir que la razón por la que más viajes los realizan personas de género femenino es que estos son la mayoría.  

```{r message=FALSE, echo = FALSE, warning = FALSE}
pieViajesXGenero()
```

\newpage  

### Duración
Se hace primero el análisis del gráfico de la distribución de duración con "outliers":  

```{r message=FALSE, echo = FALSE, warning = FALSE}
usuarios <- read.table("usuarios8.csv", header = TRUE, sep = ",")
recorridos <- read.table("recorridos8.csv", header = TRUE, sep = ",")
usuariosrecorridos <- merge(usuarios, recorridos)

boxplot(recorridos$duracion / 60,
        outline = TRUE,
        horizontal = TRUE,
        xlab = "Tiempo [minutos]",
        main = "Duracion Recorridos (con outliers)",
        col = c("#E97444"))
```

Al observarlo, se nota que hay muchos valores alejados de la media. Estas son algunas de las medidas descriptivas de la variable (en minutos):  
- Mínimo: 4  
- Primer Cuartil: 13  
- Mediana: 22  
- Promedio: 27  
- Tercer Cuartil: 32  
- Máximo: 298  
  
Ahora se analizará el gráfico sin "outliers":  

```{r message=FALSE, echo = FALSE, warning = FALSE}
boxplot(recorridos$duracion / 60,
        outline = FALSE,
        horizontal = TRUE,
        xlab = "Tiempo [minutos]",
        main = "Duracion Recorridos (sin outliers)",
        col = c("#E97444"))
```

En esta gráfica se puede ver mucho mejor los datos que nos interesan.  


\newpage  


### Distancia

En este análisis, sucede lo mismo que en el anterior: es conveniente mostrar la gráfica sin outliers. El análisis va a ser directamente de esta.  

```{r message=FALSE, echo = FALSE, warning = FALSE}
usuarios <- read.table("usuarios8.csv", header = TRUE, sep = ",")
recorridos <- read.table("recorridos8.csv", header = TRUE, sep = ",")
usuariosrecorridos <- merge(usuarios, recorridos)

boxplot(recorridos$distancia / 1000,
        outline = FALSE,
        horizontal = TRUE,
        xlab = "Distancia [km]",
        main = "Distancia Recorridos (sin outliers)",
        col = c("#9ED573"))
```


Medidas descriptivas de la variable (en metros):  
- Mínimo: 758  
- Primer Cuartil: 2788  
- Mediana: 4422  
- Promedio: 5567  
- Tercer Cuartil: 6625  
- Máximo: 70528  
  
La conclusión que se puede sacar es que la mayoría de los viajes son de media distancia, variando principalmente entre los 3 y 6 kilometros. No hay gran cantidad de viajes muy cortos ni muy largos, aunque efectivamente existen.  